<dom-module id="current-charges">
  <template>
    <style include="shared-styles"></style>

    <iron-ajax
      auto
      url="/charges/[[asBase64(currentDate)]]"
      handle-as="json"
      last-response="{{charges}}">
    </iron-ajax>

    <iron-list items="[[charges]]" multi-selection>
      <template>
        <paper-icon-item>
          <iron-icon icon="[[getIcon(item)]]" item-icon></iron-icon>
          <paper-item-body two-line>
            <div class="horizontal layout">
              <span class="flex">[[item.ActivityCode]]</span>
              <span>[[item.Hours]]</span>
            </div>
            <div secondary>
              <small>[[item.WorkComment]]</small>
            </div>
          </paper-item-body>
        </paper-icon-item>
      </template>
    </iron-list>

  </template>
  <script>
    (() => {
      'use strict';

      class CurrentCharges {
        get is() { return 'current-charges' }

        get observers() {
          return ['chargesChanged(charges)'];
        }

        chargesChanged(charges) {
          console.log(`Retrieved ${charges.length} charges`);
        }

        getIcon(item) {
          let icons = {
            'A': 'done',
            'E': 'flag',
            'N': 'av:fiber-new'
          };

          return item.StatusCode in icons ? icons[item.StatusCode] : 'bug-report';
        }

        asBase64(date) {
          return btoa(moment(date).unix() + '|' + moment(date).day(6).unix());
        }
      }

      Polymer(CurrentCharges);

    })();
  </script>
</dom-module>