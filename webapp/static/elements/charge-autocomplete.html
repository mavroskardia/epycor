<dom-module id="charge-autocomplete">
  <template>
    <style include="shared-styles">

      iron-icon, paper-icon-button {
        color: #888;
      }

      paper-typeahead {
        z-index: 1;
      }

    </style>

    <div class="horizontal layout center center-center">

      <iron-icon prefix icon="search"></iron-icon>

      <paper-typeahead id="typeahead"
        class="flex"
        no-label-float
        placeholder="Search for a charge code"
        data-key="caption"
        data="[[filteredAllocations]]"
        on-selected="selectCode">
      </paper-typeahead>

      <paper-icon-button icon="clear" on-tap="clear"></paper-icon-button>

    </div>

  </template>
  <script>
    (() => {
      'use strict';

      class ChargeAutocomplete {
        get is() { return 'charge-autocomplete' }

        get properties() {
          return {
            selectedCode: {
              type: Object,
              notify: true,
              observer: 'selectedCodeChanged'
            }
          };
        }

        selectedCodeChanged(newsc, oldsc) {
          if (!newsc) return;
          this.$.typeahead.value = newsc.caption;
        }

        selectCode(e, detail) {
          this.selectedCode = detail.targetResult;
          console.log('selected new code');
          console.log(this.selectedCode);
        }

        clear() {
          this.$.typeahead.value = '';
          this.$.typeahead.inputElement.focus();
        }
      }

      Polymer(ChargeAutocomplete);

    })();
  </script>
</dom-module>